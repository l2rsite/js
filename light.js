var Light={};jQuery.extend(!0,{context:function(a,b){if("string"==typeof b){var d=a;a=a[b];b=d}return function(){return a.apply(b,arguments)}}});Light.ajax=function(a){var b=a.success||null,d=a.error||null;a.success=function(c){try{c=$.parseJSON(c)||{}}catch(h){"function"==typeof d?d.call(this,c):"undefined"!=typeof a.errorMessage?alert(a.errorMessage):alert(Light.ajax.errorMessage);return}""!=$.trim(c.page_title)&&(document.title=c.page_title);if(c.message&&c.alert){if($.isArray(c.message)||$.isPlainObject(c.message)){var f="",e;for(e in c.message)f+=c.message[e]+"\n";c.message=f}alert(c.message)}"function"==typeof b&&b.call(this,c);""!=$.trim(c.redirect)&&setTimeout(function(){window.location=c.redirect},3E3)};$.ajax(a)};Light.ajax.errorMessage="An error occured. Please try again.";Light.Overlay=function(a){Light.Overlay.id="light-overlay";this.setting=$.extend({zIndex:3,background:null,opacity:0.9,useEffect:!1,onClickCallback:null},a);this.$overlay=$("#"+Light.Overlay.id);0==this.$overlay.length&&(this.$overlay=$("<div />").attr("id",Light.Overlay.id).appendTo(document.body));this.$overlay.css({position:"fixed",zIndex:this.setting.zIndex,background:this.setting.background,opacity:this.setting.opacity,top:0,left:0,display:"none",width:"100%",height:"100%"}).click($.context(this,"destroy")).data("effect",this.setting.useEffect);this.setting.useEffect?this.$overlay.fadeIn(300):this.$overlay.show();return this.$overlay};Light.Overlay.prototype.destroy=function(){"function"==typeof this.setting.onClickCallback&&this.setting.onClickCallback.call();Light.Overlay.hide()};Light.Overlay.create=function(a){new Light.Overlay(a)};Light.Overlay.hide=function(){var a=$("#"+Light.Overlay.id);a.length&&(a.data("effect")?a.fadeOut(null,null,function(){a.remove()}):a.remove())};Light.scrollTop=function(a,b,d,c){$("html,body").animate({scrollTop:$(a).offset().top},b||"slow",d,c)};Light.AutoComplete=function(a){this.__construct(a)};Light.AutoComplete.prototype={__construct:function(a){this.$input=a;this.url||(this.url="ajax/common");this.multiple=!1;this.minLength=2;this.queryKey="q";this.extraParams={};this.$results=null;this.selectedValue=0;this.resultVisible=!1;this.timer=null;this.setup()},setup:function(){this.$input.keyup($.context(this,"keyup"))},keyup:function(a){switch(a.keyCode){case 27:return this.hideResults();case 13:this.resultVisible&&(this.addValue(this.$results.find("li:eq("+this.selectedValue+")").text()),this.hideResults());return;case 38:0<this.selectedValue&&--this.selectedValue;this.resultHover();return;case 40:this.selectedValue<this.$results.children().length-1&&++this.selectedValue;this.resultHover();return}""==this.val()?this.hideResults():(this.timer&&clearTimeout(this.timer),this.timer=setTimeout($.context(this,"load"),250))},load:function(){this.timer&&clearTimeout(this.timer);var a=this.getPartialValue();a.length<this.minLength?clearTimeout(this.timer):(this.extraParams[this.queryKey]=a,$.ajax({url:this.url,type:"GET",data:this.extraParams,success:$.context(this,"showResults")}))},showResults:function(a){a=$.parseJSON(a).json||{};this.$results||(this.$results=$("<ul>").css({position:"absolute","z-index":100,top:this.$input.offset().top+this.$input.height()+parseInt(this.$input.css("padding-top"))+parseInt(this.$input.css("padding-bottom")),left:this.$input.offset().left}).addClass("autocomplete-list").appendTo(document.body));this.hideResults();var b=0,d;for(d in a)$("<li>").css("cursor","pointer").data("autocomplete-id",b++).addClass("item-",b).attr("data-key",d).click($.context(this,"resultClick")).hover($.context(this,"resultHover")).html(a[d].replace(RegExp("("+this.getPartialValue()+")","ig"),"<strong>$1</strong>")).appendTo(this.$results);b&&(Light.Overlay.create({onClickCallback:$.context(this,"hideResults")}),this.resultVisible=!0,this.$results.show(),this.resultHover())},resultHover:function(a){this.resultVisible&&("undefined"!=typeof a&&(this.selectedValue=$(a.currentTarget).data("autocomplete-id")),this.$results.find("li").removeClass("hover"),this.$results.find("li:eq("+this.selectedValue+")").addClass("hover"))},resultClick:function(a){this.addValue($(a.currentTarget).text());this.hideResults();this.$input.focus()},hideResults:function(){this.selectedValue=0;this.resultVisible=!1;this.$results&&this.$results.empty().hide();Light.Overlay.hide()},addValue:function(a){var b=this.getFullValues();b.pop();b.push(a);this.val(b.join(this.multiple+" "))},val:function(a){if("undefined"==typeof a)return this.getFullValues().join(this.multiple+" ");this.$input.val(a)},getPartialValue:function(){var a=this.$input.val();if(!this.multiple)return a;var b=a.lastIndexOf(this.multiple);return-1!=b?$.trim(a.substr(b+this.multiple.length)):a},getFullValues:function(){var a=$.trim(this.$input.val());if(""==a)return[];if(this.multiple){var b=a.split(this.multiple);if(1==b.length)return[a];var a=[],d;for(d in b)$.trim(b[d])&&a.push($.trim(b[d]));return a}return[a]}};Light.Popup={popName:"Chip-LightPopup",alwaysPop:!1,onNewTab:!0,eventType:1,defaults:{width:window.screen.width,height:window.screen.height,left:0,top:0,location:1,tollbar:1,status:1,menubar:1,scrollbars:1,resizable:1},newWindowDefaults:{width:window.screen.width-20,height:window.screen.height-20},__newWindow:{scrollbars:0},__counter:0,create:function(a,b){var d=b=b||{},c=this,h=c.popName+"_"+c.__counter++,f=["onNewTab","eventType","cookieExpires","alwaysPop"],e;for(e in f){var g=f[e];"undefined"!=typeof b[g]?(eval("var "+g+" = options."+g),delete b[g]):eval("var "+g+" = me."+g)}alwaysPop&&(cookieExpires=-1);for(e in c.defaults)"undefined"==typeof b[e]&&(b[e]=c.defaults[e],onNewTab||"undefined"==typeof c.newWindowDefaults[e]||(b[e]=c.newWindowDefaults[e]));for(e in c.__newWindow)b[e]=c.__newWindow[e];var k=[];for(e in b)k.push(e+"="+b[e]);var k=k.join(","),m=!1,l=function(){if(!(null!==c.cookie(h)||m||"undefined"!=typeof window.chrome&&-1!=navigator.userAgent.indexOf("Windows")&&"undefined"!=typeof ___lastPopTime&&___lastPopTime+5>(new Date).getTime())){m=!0;var b=onNewTab?window.open(a,h):window.open(a,"_blank",k);b&&b.blur();window.focus();c.cookie(h,1,cookieExpires);___lastPopTime=(new Date).getTime();-1!=navigator.userAgent.indexOf("Mac OS")&&"undefined"!=typeof window.chrome&&setTimeout(function(){b.innerWidth&&b.document.documentElement.clientWidth||c.create(a,d)},100)}};2==eventType||navigator.userAgent.match(/msie\s+(6|7|8)/i)?window.addEventListener?window.addEventListener("load",function(){document.body.addEventListener("click",l)}):window.attachEvent("onload",function(){document.body.attachEvent("onclick",l)}):1==eventType&&(window.addEventListener?window.addEventListener("click",l):window.attachEvent("onclick",l))},cookie:function(a,b,d){if(1==arguments.length){var c=document.cookie.match(RegExp(a+"=[^;]+","i"));return c?decodeURIComponent(c[0].split("=")[1]):null}null==d||"undefined"==typeof d?expires="":("number"==typeof d?(c=new Date,c.setTime(c.getTime()+864E5*d)):c=d,expires="; expires="+c.toUTCString());b=escape(b)+expires+"; path=/";document.cookie=a+"="+b}};var _gaq=_gaq||[];Light.GA={init:function(a){_gaq.push(["_setAccount",a]);_gaq.push(["_trackPageview"]);a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}};Light.Facebook={appId:null,init:function(a){this.appId=a||this.appId;var b=document.getElementsByTagName("script")[0];document.getElementById("facebook-jssdk")||(a=document.createElement("script"),a.id="facebook-jssdk",a.src="//connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v3.3&amp;appId="+this.appId,b.parentNode.insertBefore(a,b))}};
